<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>

  body {
    background-color: #D0D0D0;
  }

  .rect {
    stroke:white;
  }

  .legend_label {
    font-size: 10px;
    font-weight: bold;
    text-anchor: end;
  }

  .bar_line_tooltip {
    text-align: center;
    font-size: 12px;
    color: black;
    font-weight: bold;
    position: absolute;
    visibility: hidden;
  }

  </style>
  <script src="//d3js.org/d3.v4.min.js"></script>
</head>
<body>
  <svg width="825" height="375"></svg>
  <script>

  var svg = d3.select("svg"),
      margin = {top: 20, right: 20, bottom: 40, left: 40},
      width = +svg.attr("width") - margin.left - margin.right,
      height = +svg.attr("height") - margin.top - margin.bottom,
      g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

  d3.csv("nba_team_wins.csv", type, function(error, data) {
    if (error) throw error;

    var column_data = data.columns.slice(1);

    var x = d3.scaleBand()
        .domain(data.map(function(d) { return d.name; }))
        .rangeRound([0, width-50])
        .padding(0.4);

    var y = d3.scaleLinear()
        .domain([0, d3.max(data, function(d) { return d.total; })]).nice()
        .rangeRound([height, 0]);

    var color = d3.scaleOrdinal(d3.schemeCategory20)
        .domain(column_data);

    var stack = d3.stack();

    var display = d3.select("body")
        .append("div")
        .attr("class", "bar_line_tooltip");

    g.selectAll(".stack")
      .data(stack.keys(column_data)(data))
      .enter().append("g")
        .attr("class", "stack")
        .attr("fill", function(d) { return color(d.key); })
      .selectAll("rect")
        .data(function(d) { return d; })
        .enter().append("rect")
          .attr("class", "rect")
          .attr("x", function(d) { return x(d.data.name); })
          .attr("y", function(d) { return y(d[1]); })
          .attr("height", function(d) { return y(d[0]) - y(d[1]); })
          .attr("width", x.bandwidth())
          .on("mouseover", function() {
              d3.select(this).style("opacity", ".5");
          })
          .on("mousemove", function(d, i, columns) {
              var mouseX = event.pageX;
              var mouseY = event.pageY;
              var cur_name = d.data.name;
              var cur_value = (d[1] - d[0]);
              var toDisplay = "(" + cur_name + ", " + cur_value + ")";
              display.style("top", (mouseY - 17)+"px")
                  .style("visibility", "visible")
                  .style("left",(mouseX)+"px")
                  .text(toDisplay);
          })
          .on("mouseout", function() {
              d3.select(this).style("opacity", "1");
              display.style("visibility", "hidden");
          });

    g.append("g") //x-axis
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));

    g.append("g") //y-axis
        .call(d3.axisLeft(y).ticks(10))

    var name_legend = g.selectAll(".name_legend")
      .data(column_data.reverse())
      .enter().append("g")
        .attr("class", "name_legend")
        .attr("transform", function(d, i) { return "translate(0," + i * 17 + ")"; });

    name_legend.append("rect")
        .attr("class", "rect")
        .attr("x", width - 14)
        .attr("width", 14)
        .attr("height", 14)
        .attr("fill", color);

    name_legend.append("text")
        .attr("class", "legend_label")
        .attr("x", width - 19)
        .attr("y", 9)
        .attr("dy", 1.5)
        .text(function(d) { return d; });
  });

  function type(d, i, columns) {
    var temp_sum = 0;
    for (var i = 1; i < columns.length; ++i) {
      temp_sum += +d[columns[i]];
    }
    d.total = temp_sum;
    d.name = d[columns[0]];
    return d;
  }

  </script>
</body>
</html>